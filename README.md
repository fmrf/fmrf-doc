<!-- lang: zh_CN -->
<!-- fm01-2020/fmrf-doc -->

# 胖蚊子兔场
<https://github.com/fm01-2020/fmrf-doc>

胖蚊子兔场 (FMRF) 文档.

注: 本项目现在只是早期计划阶段. 完成度: 0%


## 概述

胖蚊子兔场 (FMRF) 是用于 **单个小微型** 兔场 (50 ~ 3000 只) 的一套 **低成本** 软硬件技术.

背景: 农业现代化 (农业与机械化, 计算机技术等相结合).

项目优势:

+ **低成本**: 可在 1 ~ 2 年内收回硬件投入成本, 硬件可连续运行 5 年以上.
  软硬件设计全部开源, 基于胖蚊子系列技术, 低成本硬件设计.

+ **技术先进**: 在低成本硬件的基础上, 实现接近顶级水平的技术.

+ **模块化**, **可扩展**: 模块化设计, 各模块可单独替换升级, 或不使用.
  小规模时可在廉价设备上简单运行, 规模增加时方便扩容.

+ **高可用**: 在保持硬件低成本的情况下, 采用冗余设计, 避免单点故障.
  实时状态监测, 应急备用及灾难恢复方案, 出现异常及时发出警告 (配合手机端消息推送).
  系统自身可在断网的情况下本地运行.
  配合胖蚊子电源 (FMUPS-1) 可在断电情况下继续运行一段时间.
  配合胖蚊子黑蜘蛛 (FMDP-4) 可远程遥控处理一些特殊紧急情况.

+ **全部开源**: 胖蚊子兔场自身的软硬件设计全部开源.
  使用的底层软件, 依赖的软件包等选择使用开源的.
  开发工具选择使用开源的.
  也就是在开发/运行胖蚊子兔场的整个过程中, 所使用的全套工具/技术都是开源的.

+ **安全性**: 主要使用 rust 编程语言, 服务端使用 APPMAC 安全模型.
  整个系统设计过程中考虑黑客攻击, 并进行预防.

+ **预留接口**: 方便接入上级平台, 构建更大规模的系统 (比如多个兔场的情况).


## 胖蚊子兔场 (软件) 主要功能

+ 数据采集与监视 (兔场监视, 自监视, 异常警告)

+ 设备遥控

+ 自动控制

+ 兔场管理


## 相关 git 仓库

| 名称 | 说明 | 备注 |
| :--- | :--- | :-- |
| [fmrf-doc](https://github.com/fm01-2020/fmrf-doc) | 胖蚊子兔场文档 | 包含硬件设计 (电路图, PCB 等) |
| fmrf-server | 服务端 | 包含 fmrf-api |
| fmrf-um | 上位机软件 | 连接现场各硬件设备 |
| fmrf-firmware | 胖蚊子兔场固件 | 现场各硬件设备单片机中执行的控制程序 |
| fmrf-cli | 命令行界面 | 包含 docker, fmrf-gateway (nginx) |
| fmrf-ui | 图形界面 | flutter (a-open-push api) |
| fmrf-ca | 证书签发/密钥管理 | 用于安全性方面 (OCSP) |
| fmrf-media | 媒体服务 | 单独部署 |
| fmrf-watchdog | 自监视 | |
| fmrf-cloud | 胖蚊子兔场瘦云端 | [可选组件] 支持多个公共云环境 (考虑最便宜的云服务器) |
| fmrf-push-ali | 手机端消息推送 (阿里云接口) | [可选组件] Android apk (独立安装) |


## 胖蚊子兔场设计目标

+ 低成本, 技术先进, 高可用, 安全, 全部开源

+ 安装简单

+ 使用方便


## 主要设计

### 胖蚊子兔场 (软件) 功能暴漏

胖蚊子兔场系统的功能主要通过这些方式提供:
**`fmrf-api`**, **`fmrf-cli`**, **`fmrf-ui`**.

+ **fmrf-api**: 服务端 (fmrf-server) API 接口 (HTTP/2 + graphql).
  系统的大部分功能都通过此接口提供.
  (除了 `fmrf host` 等只能在主机上执行的特殊命令, 比如安装/启动胖蚊子兔场)

+ **fmrf-cli**: 命令行界面.
  底层命令, 特殊命令, 常用命令.
  其中 `fmrf host` 主机命令由命令行工具直接提供, 其余功能通过访问 `fmrf-api` 实现.
  命令行界面只提供 API 功能的一小部分, 因为预期使用命令行界面的场景很少.

+ **fmrf-ui**: 图形界面.
  这是操作胖蚊子兔场的主要方式, 支持设备包括 Android 手机/平板 (apk), PC (web).
  图形界面的全部功能通过访问 `fmrf-api` 实现.
  图形界面提供 API 的大部分功能, 但不是全部 (另外一部分功能由命令行提供, 以及仅有 API 提供).

将 API 单独提出来, 并提供稳定的接口 (符合 semver), 可以方便扩展系统,
比如制作第三方工具来补充系统功能, 以及与第三方系统的对接.

图形界面是为了方便用户日常使用.

命令行界面设计为特殊/紧急情况下使用.

### 数据存储与处理技术选型

+ 不可变数据 (配置, 历史记录) 存储: git (JSON)

+ 加速缓存数据库: redis

+ 时序数据 (传感器数据, 日志) 存储: influxdb (influxdb iox, flux)

+ 媒体数据 (图片, 视频, 音频) 存储: minio

+ 时序数据采集 (系统自监视): telegraf

### 其余主要 (软件) 技术选型

+ 主要编程语言: rust (后端, 单片机)

+ 前端 (图形界面): flutter, web

+ 主要部署方式: docker

+ 主要服务端硬件平台: 树莓派 4B (8GB 内存, arm64v8)

+ fmrf-gateway: nginx (平滑升级, HTTPS 加密等)

+ 直播技术: WebRTC (flutter)

+ 视频点播: minio (mp4)

### 胖蚊子兔场最低可用性安全性要求

+ 99% 的故障次数, 恢复时间不超过 1 小时.

+ 2 次故障间隔时间, 不小于 1 个月.

+ 安全停机: 系统故障停机 (比如断电, 被物理破坏, 各种故障, 手动关闭),
  不会造成灾难性后果.

+ 系统本身不含有高危险性或可能造成严重后果的功能.

+ 安全优先于方便易用.


## LICENSE

[`CC-BY-SA 4.0+`](https://creativecommons.org/licenses/by-sa/4.0/)
